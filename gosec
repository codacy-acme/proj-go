export PROJECT_TOKEN=${{ secrets.CODACY_PROJECT_TOKEN }}
#c883239bac4242308e577abf24bcf76e
export COMMIT=$GITHUB_SHA

# 1. Run staticcheck
gosec -fmt json -log log.txt ./... | \

# 2. Convert the staticcheck output to a format that the Codacy API accepts
./codacy-gosec-0.3.8 | \

# 3. Send the results to Codacy
curl -XPOST -L -H "project-token: $PROJECT_TOKEN" \
    -H "Content-type: application/json" -d @- \
    "https://api.codacy.com/2.0/commit/$COMMIT/issuesRemoteResults"

# 4. Signal that Codacy can use the sent results and start a new analysis
curl -XPOST -L -H "project-token: $PROJECT_TOKEN" \
	-H "Content-type: application/json" \
	"https://api.codacy.com/2.0/commit/$COMMIT/resultsFinal"