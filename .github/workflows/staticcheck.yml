name: Go

on:
  push:
    branches: [ proj-go ]
  pull_request:
    branches: [ proj-go ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: run staticcheck
      uses: dominikh/staticcheck-action@v1.1.0
      with:
        version: 2021.1.1

    - name: send results to codacy
      run: | 
            $(go env GOPATH)/bin/staticcheck -f json ./...  | \ 
            java -jar codacy-staticcheck-3.0.5.jar  | \  
            curl -XPOST -L -H "project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}" \
                -H "Content-type: application/json" -d @- \
                "https://api.codacy.com/2.0/commit/$GITHUB_SHA/issuesRemoteResults"
            curl -XPOST -L -H "project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}" \
                -H "Content-type: application/json" \
                "https://api.codacy.com/2.0/commit/$GITHUB_SHA/resultsFinal"
